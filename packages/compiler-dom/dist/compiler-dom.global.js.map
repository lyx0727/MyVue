{
  "version": 3,
  "sources": ["../src/index.ts", "../../compiler-core/src/parse.ts", "../../compiler-core/src/compile.ts"],
  "sourcesContent": ["import { baseCompile } from \"@vue/compiler-core\";\r\n\r\nexport function compile(template:any){\r\n    return baseCompile(template);\r\n}", "import { NodeTypes } from \"./ast\";\r\n\r\nfunction createParserContext(template:any){\r\n    return {\r\n        line: 1,\r\n        column: 1,\r\n        offset: 0,\r\n        source: template,\r\n        originalSource: template\r\n    }\r\n}\r\n\r\nfunction isEnd(context:any){\r\n    const source = context.source;\r\n    return !source || source.startsWith('</');\r\n}\r\n\r\nfunction getCursor(context:any){\r\n    let {line, column, offset} = context;\r\n    return {line, column, offset};\r\n}\r\n\r\nfunction advancePositionWithMutation(context:any, source:any, endIndex:any){\r\n    let linesCount = 0;\r\n    let linePos = -1;\r\n    for(let i = 0; i < endIndex; i++){\r\n        // '\\n'\r\n        if(source.charCodeAt(i) === 10){\r\n            linesCount++;\r\n            linePos = i;\r\n        }\r\n    }\r\n    context.offset += endIndex;\r\n    context.line += linesCount;\r\n    context.column = \r\n        linePos === -1\r\n        ? context.column + endIndex \r\n        : endIndex - linePos;\r\n}\r\n\r\nfunction advanceBy(context:any, endIndex:any){\r\n    let source = context.source;\r\n    advancePositionWithMutation(context, source, endIndex);\r\n\r\n    context.source = source.slice(endIndex);\r\n}\r\n\r\nfunction advanceBySpaces(context:any){\r\n    const match = /^[ \\t\\r\\n]+/.exec(context.source);\r\n    if(match){\r\n        advanceBy(context, match[0].length);\r\n    }\r\n}\r\n\r\nfunction getSelection(context:any, start:any, end?:any){\r\n    end = end || getCursor(context);\r\n    return {\r\n        start,\r\n        end,\r\n        source: context.originalSource.slice(start.offset, end.offset)\r\n    }\r\n}   \r\n\r\nexport function baseParse(template:any){\r\n    const context = createParserContext(template);\r\n\r\n    return parseChildren(context);\r\n}\r\n\r\nfunction parseChildren(context:any){\r\n    const nodes:any = [];\r\n    while(!isEnd(context)){\r\n        let node = null;\r\n        const source = context.source;\r\n        // interpolation\r\n        if(source.startsWith('{{')){\r\n            node = parseInterpolation(context);\r\n        }\r\n        // element\r\n        else if(source.startsWith('<')){\r\n            node = parseElement(context);\r\n        }\r\n        // text\r\n        if(!node){\r\n            node = parseText(context);\r\n        }\r\n        nodes.push(node);\r\n    }\r\n    return nodes;\r\n}\r\n\r\nfunction parseTextData(context:any, endIndex:any){\r\n    const rawText = context.source.slice(0, endIndex);\r\n    advanceBy(context, endIndex);\r\n    return rawText;\r\n}\r\n\r\nfunction parseText(context:any){\r\n    const endTokens = ['<', '{{'];\r\n    const source = context.source;\r\n    let endIndex = source.length;\r\n\r\n    // find first end token\r\n    for(let i = 0; i < endTokens.length; i++){\r\n        let index = source.indexOf(endTokens[i]);\r\n        if(index !== -1 && endIndex > index){\r\n            endIndex = index;\r\n        }\r\n    }\r\n\r\n    const start = getCursor(context);\r\n    const content = parseTextData(context, endIndex);\r\n\r\n    return{\r\n        type: NodeTypes.TEXT,\r\n        content,\r\n        loc:getSelection(context, start)\r\n    }\r\n}   \r\n\r\nfunction parseInterpolation(context:any){\r\n    const start = getCursor(context);\r\n    const closeIndex = context.source.indexOf('}}', '{{'.length);\r\n\r\n    // ignore '{{'\r\n    advanceBy(context, 2);\r\n\r\n    const innerStart = getCursor(context);\r\n    const innerEnd = getCursor(context);\r\n\r\n    const rawContentLength = closeIndex - 2;\r\n    let preCountent = parseTextData(context, rawContentLength);\r\n    let content = preCountent.trim();\r\n\r\n    const startOffset = preCountent.indexOf(content);\r\n    // {{    xxx}}\r\n    if(startOffset > 0){\r\n        advancePositionWithMutation(innerStart, preCountent, startOffset);\r\n    }\r\n    let endOffset = startOffset + content.length;\r\n    advancePositionWithMutation(context, preCountent, endOffset);\r\n\r\n    // ignore '}}'\r\n    advanceBy(context, 2);\r\n\r\n    return {\r\n        type: NodeTypes.INTERPOLATION,\r\n        content:{\r\n            type: NodeTypes.SIMPLE_EXPRESSION,\r\n            content,\r\n            loc: getSelection(context, innerStart, innerEnd)\r\n        },\r\n        loc: getSelection(context, start)\r\n    }\r\n}\r\n\r\nfunction parseElement(context:any){\r\n    let ele = parseTag(context);\r\n    const children = parseChildren(context);\r\n    console.log(children)\r\n\r\n    if(context.source.startsWith('</')){\r\n        parseTag(context);\r\n    }\r\n    ele.loc = getSelection(context, ele.loc.start);\r\n    ele.children = children;\r\n    return ele;\r\n}\r\n\r\nfunction parseTag(context:any){\r\n    const start = getCursor(context);\r\n    const match:any = /^<\\/?([a-z][^ \\t\\r\\n/>]*)/.exec(context.source);\r\n    const tag = match[1];\r\n    advanceBy(context, match[0].length);\r\n    advanceBySpaces(context);\r\n    // <div/>\r\n    let isSelfClosing = context.source.startsWith('/>');\r\n    advanceBy(context, isSelfClosing ? 2 : 1);\r\n    return {\r\n        type: NodeTypes.ELEMENT,\r\n        tag,\r\n        isSelfClosing,\r\n        children: [],\r\n        loc: getSelection(context, start)\r\n    }\r\n}", "import { baseParse } from \"./parse\"\r\n\r\nexport function baseCompile(template: any){\r\n    const ast = baseParse(template);\r\n    return ast;\r\n}"],
  "mappings": "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",
  "names": []
}
